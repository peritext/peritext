<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">utils/referenceUtils/index.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/peritext/peritext.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">citationUtils</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/citationUtils/citationModels.js~BlockCitationModel.html">BlockCitationModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/utils/citationUtils/citationModels.js~InlineCitationModel.html">InlineCitationModel</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">componentsFactory</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-renderContents">renderContents</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-jsToComponent">jsToComponent</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">microDataUtils</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-bibToSchema">bibToSchema</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-generateOpenUrl">generateOpenUrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">modelUtils</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getContextualizerModel">getContextualizerModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getResourceModel">getResourceModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resolvePropAgainstType">resolvePropAgainstType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resolveSettings">resolveSettings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-serializePropAgainstType">serializePropAgainstType</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">referenceUtils</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-computeReferences">computeReferences</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">sectionUtils</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-deleteMeta">deleteMeta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-filterResources">filterResources</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-findByMetadata">findByMetadata</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-getMetaValue">getMetaValue</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hasMeta">hasMeta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-hasResource">hasResource</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-metaStringToCouple">metaStringToCouple</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sameMetaScope">sameMetaScope</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-setMetaValue">setMetaValue</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">utils/referenceUtils/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * Utils - dedicated to representing a reference/bibliography section
 * @module utils/referenceUtils
 */

const bibliographicTypes = [
  &apos;article&apos;,
  &apos;book&apos;,
  &apos;booklet&apos;,
  &apos;collection&apos;,
  &apos;conference&apos;,
  &apos;inbook&apos;,
  &apos;incollection&apos;,
  &apos;inproceedings&apos;,
  &apos;manual&apos;,
  &apos;mastersthesis&apos;,
  &apos;phdthesis&apos;,
  &apos;proceedings&apos;,
  &apos;techreport&apos;,
  &apos;unpublished&apos;
];

/**
 * Checks whether a given references belongs to a &quot;traditional&quot; bibliographical reference (journal article, book, ...)
 * @param {string} bibType - the bibType of the resource
 * @return {boolean} isBibliographical
 */
const isBibliographical = (bibType) =&gt;{
  const bibliType = bibliographicTypes.find((type)=&gt; {
    return bibType === type;
  });
  return bibliType !== undefined;
};

/**
 * Filter and order a list of resources against bibliography settings
 * @param {array} sections - the sections to handle for building the list
 * @param {Object} settings - the rendering settings, among which are bibliography-making related settings
 * @return {array} references - the resulting list
 */
export const computeReferences = (sections, settings) =&gt;{
  if (settings.referenceScope === &apos;document&apos;) {
    const references = sections.reduce((refs, section)=&gt; {
      return refs.concat(section.resources.filter((resource)=&gt; {
        return resource.inheritedVerticallyFrom === undefined;
      }));
    }, []);

    // handle filters
    const filters = (settings.referenceFilters || []) &amp;&amp; settings.referenceFilters.split(&apos; &apos;);
    const filteredReferences = filters.reduce((outputReferences, filter)=&gt; {
      switch (filter) {
      case &apos;has-title&apos;:
        return outputReferences.filter((ref)=&gt; {
          return ref.title !== undefined;
        });
      case &apos;bibliographical&apos;:
        return outputReferences.filter((ref)=&gt; {
          return isBibliographical(ref.bibType);
        });
      // todo : document filters
      // todo : design new filters
      default:
        return outputReferences;
      }
    }, references);

    // order references
    const order = settings.referenceSortBy;
    const sortedReferences = filteredReferences.sort((ref1, ref2)=&gt; {
      switch (order) {
      case &apos;title&apos;:
        return (ref1.title &amp;&amp; ref1.title.toLowerCase()) &gt; (ref2.title &amp;&amp; ref2.title.toLowerCase()) ? 1 : -1;
      case &apos;authors&apos;:
        const print1 = ref1.author &amp;&amp; ref1.author.reduce((str1, author1)=&gt; {
          return str1 + author1.lastName + &apos;-&apos;;
        }, &apos;&apos;);
        const print2 = ref2.author &amp;&amp; ref2.author.reduce((str2, author2)=&gt; {
          return str2 + author2.lastName + &apos;-&apos;;
        }, &apos;&apos;);
        return print1 &gt; print2 ? 1 : -1;
      case &apos;year&apos;:
        return ref1.year &gt; ref2.year ? 1 : -1;
      case &apos;type&apos;:
        return ref1.bibType &gt; ref2.bibType ? 1 : -1;
      default:
        return 1;
      }
    });
    return sortedReferences;
  }
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
